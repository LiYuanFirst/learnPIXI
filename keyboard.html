<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<script src="js/pixi.min.js" type="text/javascript" charset="utf-8"></script>
	</head>
	<body>
	</body>
	<script type="text/javascript">
		let Application = PIXI.Application,
			Container = PIXI.Container,
			loader = PIXI.loader,
			resources = PIXI.loader.resources,
			TextureCache = PIXI.utils.TextureCache,
			Sprite = PIXI.Sprite,
			Rectangle = PIXI.Rectangle;
		let app = new Application({
			width:256,
			height:256,
			antialias:true,
			transparent:false,
			resolution:1
		});
		document.body.appendChild(app.view);
		loader
			.add("assets/cat.png")
			.load(setup);
		let cat,state;
		function setup(){
			cat = new Sprite(
				resources["assets/cat.png"].texture
			);
			cat.y = 96;
			cat.vx = 0;
  			cat.vy = 0;
			app.stage.addChild(cat);
			let left = keyboard(37),
			    up = keyboard(38),
			    right = keyboard(39),
			    down = keyboard(40);
			left.press = () => {
			    cat.vx = -5;
			    cat.vy = 0;
			};
			left.release = () => {
			    if (!right.isDown && cat.vy === 0) {
			      cat.vx = 0;
			    }
			};
			
			//Up
			up.press = () => {
			    cat.vy = -5;
			    cat.vx = 0;
			};
			up.release = () => {
			    if (!down.isDown && cat.vx === 0) {
			      cat.vy = 0;
			    }
			};
			
			//Right
			right.press = () => {
			    cat.vx = 5;
			    cat.vy = 0;
			};
			right.release = () => {
			    if (!left.isDown && cat.vy === 0) {
			      cat.vx = 0;
			    }
			};
			
			//Down
			down.press = () => {
			    cat.vy = 5;
			    cat.vx = 0;
			};
			down.release = () => {
			    if (!up.isDown && cat.vx === 0) {
			      cat.vy = 0;
			    }
			};
			
			state = play;
			app.ticker.add(delta => gameLoop(delta));
		}
		function gameLoop(delta){
			state(delta)
			
		}
		function play(delta){
			
		  	if(cat.x>=256){
		  		cat.x = 0
		  		cat.y = 0
		  	}
		  	cat.x += cat.vx;
  			cat.y += cat.vy
		}
		
		function keyboard(keyCode) {
			let key = {};
			key.code = keyCode;
			key.isDown = false;
			key.isUp = true;
			key.press = undefined;
			key.release = undefined;
			key.downHandler = event => {
				if(event.keyCode === key.code){
					if(key.isUp && key.press) key.press();
					key.isDown = true;
					key.isUp = false;
				}
				event.preventDefault();
			};
			key.upHandler = event => {
			    if (event.keyCode === key.code) {
			      if (key.isDown && key.release) key.release();
			      key.isDown = false;
			      key.isUp = true;
			    }
			    event.preventDefault();
			};
			window.addEventListener(
			    "keydown", key.downHandler.bind(key), false
			);
			window.addEventListener(
			    "keyup", key.upHandler.bind(key), false
			);
			return key;
			
		}
	</script>
</html>
